name: tailscale-funnel-manager

services:
  tailscale-funnel-manager:
    image: tailscale/tailscale:latest
    container_name: tailscale-funnel-manager
    restart: unless-stopped
    command: >
      sh -c "
      echo 'ğŸš€ Starting Tailscale Funnel Manager v2.0...' &&
      apk add --no-cache nodejs npm git curl &&
      rm -rf /app &&
      git clone https://github.com/WillianQuintino/tailscale-funnel-manager.git /app &&
      cd /app &&
      npm install &&
      npm run build &&
      echo 'ğŸ“Š Starting Tailscale daemon...' &&
      tailscaled --state-dir=/var/lib/tailscale --tun=userspace-networking &
      sleep 3 &&
      echo 'ğŸŒ Starting Next.js application...' &&
      npm start
      "
    ports:
      - target: 3000
        published: ${WEBUI_PORT:-3000}
        protocol: tcp
    volumes:
      - type: bind
        source: /DATA/AppData/$AppID/data
        target: /app/data
        bind:
          create_host_path: true
      - type: bind
        source: /DATA/AppData/$AppID/tailscale
        target: /var/lib/tailscale
        bind:
          create_host_path: true
      - type: bind
        source: /var/run/docker.sock
        target: /var/run/docker.sock
        read_only: false
      - type: bind
        source: /dev/net/tun
        target: /dev/net/tun
        bind:
          create_host_path: true
    cap_add:
      - NET_ADMIN
      - NET_RAW
    privileged: true
    network_mode: host
    environment:
      - TZ=$TZ
      - PUID=$PUID
      - PGID=$PGID
      - NODE_ENV=production
      - TS_STATE_DIR=/var/lib/tailscale
      - TS_HOSTNAME=${TS_HOSTNAME:-CasaOS-TFM}
      - TS_EXTRA_ARGS=--accept-routes --accept-dns
      - AUTH_ENABLED=false
      - AUTH_TYPE=tailscale
    x-casaos:
      envs:
        - container: TZ
          description:
            en_US: Timezone setting for the container
            pt_BR: ConfiguraÃ§Ã£o de fuso horÃ¡rio para o container
        - container: PUID
          description:
            en_US: User ID for file permissions
            pt_BR: ID do usuÃ¡rio para permissÃµes de arquivo
        - container: PGID
          description:
            en_US: Group ID for file permissions
            pt_BR: ID do grupo para permissÃµes de arquivo
        - container: NODE_ENV
          description:
            en_US: Node.js environment (production/development)
            pt_BR: Ambiente Node.js (production/development)
        - container: AUTH_ENABLED
          description:
            en_US: Enable authentication (true/false)
            pt_BR: Habilitar autenticaÃ§Ã£o (true/false)
        - container: AUTH_TYPE
          description:
            en_US: Authentication type (tailscale/casaos/custom)
            pt_BR: Tipo de autenticaÃ§Ã£o (tailscale/casaos/custom)
      ports:
        - container: "3000"
          description:
            en_US: Web interface port
            pt_BR: Porta da interface web
      volumes:
        - container: /app/data
          description:
            en_US: Application data and configuration
            pt_BR: Dados e configuraÃ§Ã£o da aplicaÃ§Ã£o
        - container: /var/lib/tailscale
          description:
            en_US: Tailscale state and configuration
            pt_BR: Estado e configuraÃ§Ã£o do Tailscale
        - container: /var/run/docker.sock
          description:
            en_US: Docker socket for container discovery
            pt_BR: Socket Docker para descoberta de containers

x-casaos:
  architectures:
    - amd64
    - arm64
  main: tailscale-funnel-manager
  author: WillianQuintino
  category: Network
  description:
    en_US: A modern Next.js web interface to create and manage Tailscale Funnels for your CasaOS containers and services. Features a beautiful glassmorphism UI, automatic container discovery, CasaOS integration, real-time status monitoring, and one-click funnel creation. Supports both Auth Key and browser-based authentication flows.
    pt_BR: Uma interface web moderna em Next.js para criar e gerenciar Tailscale Funnels para seus containers e serviÃ§os CasaOS. Apresenta uma bela UI glassmorphism, descoberta automÃ¡tica de containers, integraÃ§Ã£o CasaOS, monitoramento de status em tempo real e criaÃ§Ã£o de funnel com um clique. Suporta tanto Auth Key quanto fluxos de autenticaÃ§Ã£o baseados em navegador.
  developer: WillianQuintino
  icon: https://cdn.jsdelivr.net/gh/WillianQuintino/casaos-tailscale-appstore@main/Apps/tailscale-funnel-manager/icon.png
  tagline:
    en_US: Modern Tailscale Funnel management with glassmorphism UI
    pt_BR: Gerenciamento moderno de Tailscale Funnel com UI glassmorphism
  title:
    en_US: Tailscale Funnel Manager
    pt_BR: Gerenciador Tailscale Funnel
  tips:
    before_install:
      en_US: |
        ğŸš€ **NEW VERSION 2.0** - Now with Next.js and modern UI!

        **Requirements:**
        1. Tailscale account (free at https://tailscale.com)
        2. Auth Key OR browser authentication (both supported!)
        3. Internet access for your CasaOS server
        4. Funnel ports: 443, 8443, or 10000

        **New Features:**
        âœ¨ Beautiful glassmorphism interface
        ğŸ”— Browser-based login URL generation
        ğŸ³ Automatic Docker container discovery
        ğŸ  CasaOS apps integration
        ğŸ“Š Real-time status monitoring
        ğŸ”„ WebSocket live updates
      pt_BR: |
        ğŸš€ **NOVA VERSÃƒO 2.0** - Agora com Next.js e UI moderna!

        **Requisitos:**
        1. Conta Tailscale (gratuita em https://tailscale.com)
        2. Auth Key OU autenticaÃ§Ã£o via navegador (ambos suportados!)
        3. Acesso Ã  internet para seu servidor CasaOS
        4. Portas de funnel: 443, 8443 ou 10000

        **Novos Recursos:**
        âœ¨ Interface glassmorphism linda
        ğŸ”— GeraÃ§Ã£o de URL de login via navegador
        ğŸ³ Descoberta automÃ¡tica de containers Docker
        ğŸ  IntegraÃ§Ã£o com apps CasaOS
        ğŸ“Š Monitoramento de status em tempo real
        ğŸ”„ AtualizaÃ§Ãµes ao vivo via WebSocket
    after_install:
      en_US: |
        ğŸ‰ **Installation Complete!**

        **Getting Started:**
        1. ğŸŒ Access: http://your-server:${WEBUI_PORT:-3000}
        2. ğŸ”§ **Two setup options:**
           - ğŸ”‘ **Auth Key**: Enter your Tailscale auth key
           - ğŸŒ **Browser Login**: Click "Get Login URL" for easy setup
        3. â³ Wait for connection and authentication
        4. ğŸ” Your containers will be auto-discovered
        5. ğŸš€ Create funnels with one-click
        6. ğŸŒ Access services from anywhere with HTTPS URLs

        **New Features in v2.0:**
        - ğŸ“± Mobile-responsive glassmorphism UI
        - ğŸ”„ Real-time status updates
        - ğŸ³ Smart container detection
        - ğŸ  CasaOS integration
        - ğŸ”— No-hassle browser authentication
      pt_BR: |
        ğŸ‰ **InstalaÃ§Ã£o Completa!**

        **Primeiros Passos:**
        1. ğŸŒ Acesse: http://seu-servidor:${WEBUI_PORT:-3000}
        2. ğŸ”§ **Duas opÃ§Ãµes de configuraÃ§Ã£o:**
           - ğŸ”‘ **Auth Key**: Insira sua chave de autenticaÃ§Ã£o Tailscale
           - ğŸŒ **Login via Navegador**: Clique "Obter URL de Login" para configuraÃ§Ã£o fÃ¡cil
        3. â³ Aguarde conexÃ£o e autenticaÃ§Ã£o
        4. ğŸ” Seus containers serÃ£o auto-descobertos
        5. ğŸš€ Crie funnels com um clique
        6. ğŸŒ Acesse serviÃ§os de qualquer lugar com URLs HTTPS

        **Novos Recursos na v2.0:**
        - ğŸ“± UI glassmorphism responsiva para mobile
        - ğŸ”„ AtualizaÃ§Ãµes de status em tempo real
        - ğŸ³ DetecÃ§Ã£o inteligente de containers
        - ğŸ  IntegraÃ§Ã£o com CasaOS
        - ğŸ”— AutenticaÃ§Ã£o via navegador sem complicaÃ§Ãµes
  thumbnail: https://cdn.jsdelivr.net/gh/WillianQuintino/casaos-tailscale-appstore@main/Apps/tailscale-funnel-manager/thumbnail.png
  index: /
  port_map: ${WEBUI_PORT:-3000}

name: tailscale-funnel-manager

services:
  tailscale-funnel-manager:
    image: tailscale/tailscale:latest
    container_name: tailscale-funnel-manager
    restart: unless-stopped
    command: >
      sh -c "
      echo '🚀 Starting Tailscale Funnel Manager v2.0...' &&
      apk add --no-cache nodejs npm git curl &&
      rm -rf /app &&
      git clone https://github.com/WillianQuintino/tailscale-funnel-manager.git /app &&
      cd /app &&
      npm install &&
      npm run build &&
      echo '📊 Starting Tailscale daemon...' &&
      tailscaled --state-dir=/var/lib/tailscale --tun=userspace-networking &
      sleep 3 &&
      echo '🌐 Starting Next.js application...' &&
      npm start
      "
    ports:
      - target: 3000
        published: ${WEBUI_PORT:-3000}
        protocol: tcp
    volumes:
      - type: bind
        source: /DATA/AppData/$AppID/data
        target: /app/data
        bind:
          create_host_path: true
      - type: bind
        source: /DATA/AppData/$AppID/tailscale
        target: /var/lib/tailscale
        bind:
          create_host_path: true
      - type: bind
        source: /var/run/docker.sock
        target: /var/run/docker.sock
        read_only: false
      - type: bind
        source: /dev/net/tun
        target: /dev/net/tun
        bind:
          create_host_path: true
    cap_add:
      - NET_ADMIN
      - NET_RAW
    privileged: true
    network_mode: host
    environment:
      - TZ=$TZ
      - PUID=$PUID
      - PGID=$PGID
      - NODE_ENV=production
      - TS_STATE_DIR=/var/lib/tailscale
      - TS_HOSTNAME=${TS_HOSTNAME:-CasaOS-TFM}
      - TS_EXTRA_ARGS=--accept-routes --accept-dns
      - AUTH_ENABLED=false
      - AUTH_TYPE=tailscale
    x-casaos:
      envs:
        - container: TZ
          description:
            en_US: Timezone setting for the container
            pt_BR: Configuração de fuso horário para o container
        - container: PUID
          description:
            en_US: User ID for file permissions
            pt_BR: ID do usuário para permissões de arquivo
        - container: PGID
          description:
            en_US: Group ID for file permissions
            pt_BR: ID do grupo para permissões de arquivo
        - container: NODE_ENV
          description:
            en_US: Node.js environment (production/development)
            pt_BR: Ambiente Node.js (production/development)
        - container: AUTH_ENABLED
          description:
            en_US: Enable authentication (true/false)
            pt_BR: Habilitar autenticação (true/false)
        - container: AUTH_TYPE
          description:
            en_US: Authentication type (tailscale/casaos/custom)
            pt_BR: Tipo de autenticação (tailscale/casaos/custom)
      ports:
        - container: "3000"
          description:
            en_US: Web interface port
            pt_BR: Porta da interface web
      volumes:
        - container: /app/data
          description:
            en_US: Application data and configuration
            pt_BR: Dados e configuração da aplicação
        - container: /var/lib/tailscale
          description:
            en_US: Tailscale state and configuration
            pt_BR: Estado e configuração do Tailscale
        - container: /var/run/docker.sock
          description:
            en_US: Docker socket for container discovery
            pt_BR: Socket Docker para descoberta de containers

x-casaos:
  architectures:
    - amd64
    - arm64
  main: tailscale-funnel-manager
  author: WillianQuintino
  category: Network
  description:
    en_US: A modern Next.js web interface to create and manage Tailscale Funnels for your CasaOS containers and services. Features a beautiful glassmorphism UI, automatic container discovery, CasaOS integration, real-time status monitoring, and one-click funnel creation. Supports both Auth Key and browser-based authentication flows.
    pt_BR: Uma interface web moderna em Next.js para criar e gerenciar Tailscale Funnels para seus containers e serviços CasaOS. Apresenta uma bela UI glassmorphism, descoberta automática de containers, integração CasaOS, monitoramento de status em tempo real e criação de funnel com um clique. Suporta tanto Auth Key quanto fluxos de autenticação baseados em navegador.
  developer: WillianQuintino
  icon: https://cdn.jsdelivr.net/gh/WillianQuintino/casaos-tailscale-appstore@main/Apps/tailscale-funnel-manager/icon.png
  tagline:
    en_US: Modern Tailscale Funnel management with glassmorphism UI
    pt_BR: Gerenciamento moderno de Tailscale Funnel com UI glassmorphism
  title:
    en_US: Tailscale Funnel Manager
    pt_BR: Gerenciador Tailscale Funnel
  tips:
    before_install:
      en_US: |
        🚀 **NEW VERSION 2.0** - Now with Next.js and modern UI!

        **Requirements:**
        1. Tailscale account (free at https://tailscale.com)
        2. Auth Key OR browser authentication (both supported!)
        3. Internet access for your CasaOS server
        4. Funnel ports: 443, 8443, or 10000

        **New Features:**
        ✨ Beautiful glassmorphism interface
        🔗 Browser-based login URL generation
        🐳 Automatic Docker container discovery
        🏠 CasaOS apps integration
        📊 Real-time status monitoring
        🔄 WebSocket live updates
      pt_BR: |
        🚀 **NOVA VERSÃO 2.0** - Agora com Next.js e UI moderna!

        **Requisitos:**
        1. Conta Tailscale (gratuita em https://tailscale.com)
        2. Auth Key OU autenticação via navegador (ambos suportados!)
        3. Acesso à internet para seu servidor CasaOS
        4. Portas de funnel: 443, 8443 ou 10000

        **Novos Recursos:**
        ✨ Interface glassmorphism linda
        🔗 Geração de URL de login via navegador
        🐳 Descoberta automática de containers Docker
        🏠 Integração com apps CasaOS
        📊 Monitoramento de status em tempo real
        🔄 Atualizações ao vivo via WebSocket
    after_install:
      en_US: |
        🎉 **Installation Complete!**

        **Getting Started:**
        1. 🌐 Access: http://your-server:${WEBUI_PORT:-3000}
        2. 🔧 **Two setup options:**
           - 🔑 **Auth Key**: Enter your Tailscale auth key
           - 🌐 **Browser Login**: Click "Get Login URL" for easy setup
        3. ⏳ Wait for connection and authentication
        4. 🔍 Your containers will be auto-discovered
        5. 🚀 Create funnels with one-click
        6. 🌍 Access services from anywhere with HTTPS URLs

        **New Features in v2.0:**
        - 📱 Mobile-responsive glassmorphism UI
        - 🔄 Real-time status updates
        - 🐳 Smart container detection
        - 🏠 CasaOS integration
        - 🔗 No-hassle browser authentication
      pt_BR: |
        🎉 **Instalação Completa!**

        **Primeiros Passos:**
        1. 🌐 Acesse: http://seu-servidor:${WEBUI_PORT:-3000}
        2. 🔧 **Duas opções de configuração:**
           - 🔑 **Auth Key**: Insira sua chave de autenticação Tailscale
           - 🌐 **Login via Navegador**: Clique "Obter URL de Login" para configuração fácil
        3. ⏳ Aguarde conexão e autenticação
        4. 🔍 Seus containers serão auto-descobertos
        5. 🚀 Crie funnels com um clique
        6. 🌍 Acesse serviços de qualquer lugar com URLs HTTPS

        **Novos Recursos na v2.0:**
        - 📱 UI glassmorphism responsiva para mobile
        - 🔄 Atualizações de status em tempo real
        - 🐳 Detecção inteligente de containers
        - 🏠 Integração com CasaOS
        - 🔗 Autenticação via navegador sem complicações
  thumbnail: https://cdn.jsdelivr.net/gh/WillianQuintino/casaos-tailscale-appstore@main/Apps/tailscale-funnel-manager/thumbnail.png
  index: /
  port_map: ${WEBUI_PORT:-3000}
